{"version":3,"file":"sifrrcodeeditor.module.js","sources":["../src/sifrrcodeeditor.js"],"sourcesContent":["import SifrrDom from '@sifrr/dom';\nimport style from './style.scss';\n\nconst CM_VERSION = '5.48.0';\n\nconst template = SifrrDom.template`\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/codemirror@${CM_VERSION}/lib/codemirror.css\">\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/codemirror@${CM_VERSION}/theme/\\${this.getTheme()}.css\">\n<style media=\"screen\">\n  ${style}\n</style>\n<textarea></textarea>`;\n\nclass SifrrCodeEditor extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['value', 'theme', 'lang'];\n  }\n\n  static syncedAttrs() {\n    return ['theme'];\n  }\n\n  static cm() {\n    this._cm =\n      this._cm ||\n      SifrrDom.Loader.executeJS(\n        `https://cdn.jsdelivr.net/npm/codemirror@${CM_VERSION}/lib/codemirror.js`\n      );\n    return this._cm;\n  }\n\n  onAttributeChange(n, _, v) {\n    if (this._cmLoaded) {\n      if (n === 'theme') this.cm.setOption('theme', v);\n      if (n === 'lang') this.cm.setOption('mode', this.getTheme());\n    }\n  }\n\n  onConnect() {\n    this.constructor.cm().then(() => this.cmLoaded());\n  }\n\n  input() {\n    SifrrDom.Event.trigger(this, 'input');\n    this.update();\n  }\n\n  cmLoaded() {\n    SifrrDom.Loader.executeJS(\n      `https://cdn.jsdelivr.net/npm/codemirror@${CM_VERSION}/mode/${this.lang}/${this.lang}.js`\n    ).then(() => {\n      this.cm = window.CodeMirror.fromTextArea(this.$('textarea'), {\n        value: this.$('textarea').value,\n        mode: this.lang,\n        htmlMode: true,\n        theme: this.getTheme(),\n        indentUnit: 2,\n        tabSize: 2,\n        lineNumbers: true\n      });\n      this.cm.on('change', this.input.bind(this));\n      this._cmLoaded = true;\n    });\n  }\n\n  getTheme() {\n    return this.theme ? this.theme.split(' ')[0] : 'dracula';\n  }\n\n  get value() {\n    if (this._cmLoaded) return this.cm.getValue();\n    else return this.$('textarea').value;\n  }\n\n  set value(v) {\n    if (v === this.value) return;\n    if (this._cmLoaded) return this.cm.setValue(v);\n    else this.$('textarea').value = v;\n  }\n\n  get lang() {\n    const attr = this.getAttribute('lang');\n    if (!attr || attr === 'html') return 'xml';\n    return attr;\n  }\n}\n\nSifrrDom.register(SifrrCodeEditor);\n\nexport default SifrrCodeEditor;\n"],"names":["style"],"mappings":"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"}