{"version":3,"file":"sifrrcodeeditor.js","sources":["../src/sifrrcodeeditor.js"],"sourcesContent":["import SifrrDom from '@sifrr/dom';\nimport style from './style.scss';\n\nconst template = SifrrDom.template`\n<style media=\"screen\">\n  ${style}\n</style>\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/\\${this.theme}.min.css\">\n<pre class='hljs'>\n  <code id=\"highlight\" data-sifrr-html=\"true\">\n    \\${this.htmlValue}\n  </code>\n</pre>\n<textarea class='hljs' _input=\"\\${this.input}\" _scroll=\"console.log(this)\"></textarea>`;\n\nclass SifrrCodeEditor extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['value', 'theme'];\n  }\n\n  static hljs() {\n    this._hljs = this._hljs || fetch('https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js')\n      .then(resp => resp.text())\n      .then(text => new Function(text)());\n    return this._hljs;\n  }\n\n  onAttributeChange() {\n    this.update();\n  }\n\n  onConnect() {\n    this.constructor.hljs().then(() => this.hljsLoaded());\n\n    const txtarea = this.$('textarea');\n    txtarea.addEventListener('keydown', (e) => {\n      let keyCode = e.keyCode || e.which;\n      this.$('#highlight').style.height = this.$('textarea').height;\n      if (keyCode == 9) {\n        e.preventDefault();\n        const start = txtarea.selectionStart;\n        const end = txtarea.selectionEnd;\n\n        const tabCharacter = '  ';\n        const tabOffset = 2;\n\n        // set textarea value to: text before caret + tab + text after caret\n        txtarea.value = txtarea.value.substring(0, start) + tabCharacter + txtarea.value.substring(end);\n\n        // put caret at right position again\n        txtarea.selectionStart = txtarea.selectionEnd = start + tabOffset;\n      }\n    });\n    txtarea.onscroll = () => {\n      this.$('pre.hljs').scrollTop = txtarea.scrollTop;\n    };\n  }\n\n  input() {\n    SifrrDom.Event.trigger(this, 'input');\n    this.update();\n  }\n\n  hljsLoaded() {\n    this.$('textarea').classList.add('loaded');\n    this.update();\n  }\n\n  get htmlValue() {\n    if (window.hljs) return window.hljs.highlight(this.lang, this.value).value;\n    else return this.value.replace(/</g, '&lt;');\n  }\n\n  get theme() {\n    return this.getAttribute('theme') || 'atom-one-dark';\n  }\n\n  set theme(v) {\n    this.setAttribute('theme', v);\n    this.update();\n  }\n\n  get value() {\n    return this.$('textarea').value;\n  }\n\n  set value(v) {\n    this.$('textarea').value = v;\n    this.update();\n  }\n\n  get lang() {\n    return this.getAttribute('lang') || 'html';\n  }\n}\n\nSifrrDom.register(SifrrCodeEditor);\n\nexport default SifrrCodeEditor;\n"],"names":["template","SifrrDom","style","SifrrCodeEditor","Element","observedAttrs","hljs","_hljs","fetch","then","resp","text","Function","onAttributeChange","update","onConnect","constructor","hljsLoaded","txtarea","$","addEventListener","e","keyCode","which","height","preventDefault","start","selectionStart","end","selectionEnd","tabCharacter","tabOffset","value","substring","onscroll","scrollTop","input","Event","trigger","classList","add","htmlValue","window","highlight","lang","replace","theme","getAttribute","v","setAttribute","register"],"mappings":"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"}