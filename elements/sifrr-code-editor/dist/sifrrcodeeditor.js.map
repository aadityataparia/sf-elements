{"version":3,"file":"sifrrcodeeditor.js","sources":["../src/sifrrcodeeditor.js"],"sourcesContent":["import SifrrDom from '@sifrr/dom';\nimport style from './style.scss';\n\nconst CM_VERSION = '5.48.0';\n\nconst template = SifrrDom.template`\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/codemirror@${CM_VERSION}/lib/codemirror.css\">\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/codemirror@${CM_VERSION}/theme/\\${this.getTheme()}.css\">\n<style media=\"screen\">\n  ${style}\n</style>\n<textarea></textarea>`;\n\nclass SifrrCodeEditor extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['value', 'theme', 'lang'];\n  }\n\n  static syncedAttrs() {\n    return ['theme'];\n  }\n\n  static cm() {\n    this._cm = this._cm || SifrrDom.Loader.executeJS(`https://cdn.jsdelivr.net/npm/codemirror@${CM_VERSION}/lib/codemirror.js`);\n    return this._cm;\n  }\n\n  onAttributeChange(n, _, v) {\n    if (this._cmLoaded) {\n      if (n === 'theme') this.cm.setOption('theme', v);\n      if (n === 'lang') this.cm.setOption('mode', this.getTheme());\n    }\n  }\n\n  onConnect() {\n    this.constructor.cm().then(() => this.cmLoaded());\n  }\n\n  input() {\n    SifrrDom.Event.trigger(this, 'input');\n    this.update();\n  }\n\n  cmLoaded() {\n    SifrrDom.Loader.executeJS(`https://cdn.jsdelivr.net/npm/codemirror@${CM_VERSION}/mode/${this.lang}/${this.lang}.js`)\n      .then(() => {\n        this.cm = window.CodeMirror.fromTextArea(this.$('textarea'), {\n          value: this.$('textarea').value,\n          mode: this.lang,\n          htmlMode: true,\n          theme: this.getTheme(),\n          indentUnit: 2,\n          tabSize: 2,\n          lineNumbers: true\n        });\n        this.cm.on('change', this.input.bind(this));\n        this._cmLoaded = true;\n      });\n  }\n\n  getTheme() {\n    return this.theme ? this.theme.split(' ')[0] : 'dracula';\n  }\n\n  get value() {\n    if (this._cmLoaded) return this.cm.getValue();\n    else return this.$('textarea').value;\n  }\n\n  set value(v) {\n    if (v === this.value) return;\n    if (this._cmLoaded) return this.cm.setValue(v);\n    else this.$('textarea').value = v;\n  }\n\n  get lang() {\n    const attr = this.getAttribute('lang');\n    if (!attr || attr === 'html') return 'xml';\n    return attr;\n  }\n}\n\nSifrrDom.register(SifrrCodeEditor);\n\nexport default SifrrCodeEditor;\n"],"names":["CM_VERSION","template","SifrrDom","style","SifrrCodeEditor","Element","observedAttrs","syncedAttrs","cm","_cm","Loader","executeJS","onAttributeChange","n","_","v","_cmLoaded","setOption","getTheme","onConnect","constructor","then","cmLoaded","input","Event","trigger","update","lang","window","CodeMirror","fromTextArea","$","value","mode","htmlMode","theme","indentUnit","tabSize","lineNumbers","on","bind","split","getValue","setValue","attr","getAttribute","register"],"mappings":"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"}