{"version":3,"file":"sifrrcodeeditor.js","sources":["../src/sifrrcodeeditor.js"],"sourcesContent":["import SifrrDom from '@sifrr/dom';\nimport style from './style.scss';\n\nconst template = SifrrDom.template`\n<style media=\"screen\">\n  ${style}\n</style>\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/atom-one-dark.min.css\">\n<pre class='hljs'>\n  <code id=\"highight\" data-sifrr-html=\"true\">\n    \\${this.htmlValue}\n  </code>\n</pre>\n<textarea class='hljs' _input=\"\\${this.input}\"></textarea>`;\n\nSifrrDom.Event.add('load');\nclass SifrrCodeEditor extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  onAttributeChange() {\n    this.update();\n  }\n\n  onConnect() {\n    const script = document.createElement('script');\n    script.src = \"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js\";\n    script.onLoad = this.update();\n    document.body.appendChild(script);\n\n    const txtarea = this.$('textarea');\n    this.$('textarea').addEventListener('keydown', (e) => {\n      let keyCode = e.keyCode || e.which;\n      if (keyCode == 9) {\n        e.preventDefault();\n        const start = txtarea.selectionStart;\n        const end = txtarea.selectionEnd;\n\n        const tabCharacter = '  ';\n        const tabOffset = 2;\n\n        // set textarea value to: text before caret + tab + text after caret\n        txtarea.value = txtarea.value.substring(0, start) + tabCharacter + txtarea.value.substring(end);\n\n        // put caret at right position again\n        txtarea.selectionStart = txtarea.selectionEnd = start + tabOffset;\n      }\n    });\n  }\n\n  input() {\n    SifrrDom.Event.trigger(this, 'input');\n    this.update();\n  }\n\n  get htmlValue() {\n    if (window.hljs) return hljs.highlight(this.lang, this.value).value;\n    else return this.value;\n  }\n\n  get value() {\n    return this.$('textarea').value;\n  }\n\n  set value(v) {\n    this.$('textarea').value = v;\n    this.update();\n  }\n\n  get lang() {\n    return this.getAttribute('lang') || 'html';\n  }\n}\n\nif (window) SifrrDom.register(SifrrCodeEditor);\n\nexport default SifrrCodeEditor;\n"],"names":["template","SifrrDom","style","Event","add","SifrrCodeEditor","Element","onAttributeChange","update","onConnect","script","document","createElement","src","onLoad","body","appendChild","txtarea","$","addEventListener","e","keyCode","which","preventDefault","start","selectionStart","end","selectionEnd","tabCharacter","tabOffset","value","substring","input","trigger","htmlValue","window","hljs","highlight","lang","v","getAttribute","register"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,EAGA,MAAMA,QAAQ,GAAGC,QAAQ,CAACD,QAAZ,oBAEVE,GAFU,CAAd;EAYAD,QAAQ,CAACE,KAAT,CAAeC,GAAf,CAAmB,MAAnB;EACA,MAAMC,eAAN,SAA8BJ,QAAQ,CAACK,OAAvC,CAA+C;EAC7C,aAAWN,QAAX,GAAsB;EACpB,WAAOA,QAAP;EACD;EAEDO,EAAAA,iBAAiB,GAAG;EAClB,SAAKC,MAAL;EACD;EAEDC,EAAAA,SAAS,GAAG;EACV,UAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf;EACAF,IAAAA,MAAM,CAACG,GAAP,GAAa,6EAAb;EACAH,IAAAA,MAAM,CAACI,MAAP,GAAgB,KAAKN,MAAL,EAAhB;EACAG,IAAAA,QAAQ,CAACI,IAAT,CAAcC,WAAd,CAA0BN,MAA1B;EAEA,UAAMO,OAAO,GAAG,KAAKC,CAAL,CAAO,UAAP,CAAhB;EACA,SAAKA,CAAL,CAAO,UAAP,EAAmBC,gBAAnB,CAAoC,SAApC,EAAgDC,CAAD,IAAO;EACpD,UAAIC,OAAO,GAAGD,CAAC,CAACC,OAAF,IAAaD,CAAC,CAACE,KAA7B;EACA,UAAID,OAAO,IAAI,CAAf,EAAkB;EAChBD,QAAAA,CAAC,CAACG,cAAF;EACA,cAAMC,KAAK,GAAGP,OAAO,CAACQ,cAAtB;EACA,cAAMC,GAAG,GAAGT,OAAO,CAACU,YAApB;EAEA,cAAMC,YAAY,GAAG,IAArB;EACA,cAAMC,SAAS,GAAG,CAAlB,CANgB;EAShBZ,QAAAA,OAAO,CAACa,KAAR,GAAgBb,OAAO,CAACa,KAAR,CAAcC,SAAd,CAAwB,CAAxB,EAA2BP,KAA3B,IAAoCI,YAApC,GAAmDX,OAAO,CAACa,KAAR,CAAcC,SAAd,CAAwBL,GAAxB,CAAnE,CATgB;EAYhBT,QAAAA,OAAO,CAACQ,cAAR,GAAyBR,OAAO,CAACU,YAAR,GAAuBH,KAAK,GAAGK,SAAxD;EACD;EACF,KAhBD;EAiBD;EAEDG,EAAAA,KAAK,GAAG;EACN/B,IAAAA,QAAQ,CAACE,KAAT,CAAe8B,OAAf,CAAuB,IAAvB,EAA6B,OAA7B;EACA,SAAKzB,MAAL;EACD;EAED,MAAI0B,SAAJ,GAAgB;EACd,QAAIC,MAAM,CAACC,IAAX,EAAiB,OAAOA,IAAI,CAACC,SAAL,CAAe,KAAKC,IAApB,EAA0B,KAAKR,KAA/B,EAAsCA,KAA7C,CAAjB,KACK,OAAO,KAAKA,KAAZ;EACN;EAED,MAAIA,KAAJ,GAAY;EACV,WAAO,KAAKZ,CAAL,CAAO,UAAP,EAAmBY,KAA1B;EACD;EAED,MAAIA,KAAJ,CAAUS,CAAV,EAAa;EACX,SAAKrB,CAAL,CAAO,UAAP,EAAmBY,KAAnB,GAA2BS,CAA3B;EACA,SAAK/B,MAAL;EACD;EAED,MAAI8B,IAAJ,GAAW;EACT,WAAO,KAAKE,YAAL,CAAkB,MAAlB,KAA6B,MAApC;EACD;EAxD4C;EA2D/C,IAAIL,MAAJ,EAAYlC,QAAQ,CAACwC,QAAT,CAAkBpC,eAAlB;;;;;;;;;;;"}