{"version":3,"file":"sifrrtabheader.module.js","sources":["../src/sifrrtabheader.js"],"sourcesContent":["import SifrrDom from '@sifrr/dom';\nimport style from './style.scss';\n\nconst template = SifrrDom.template`<style media=\"screen\">\n  ${style}\n  slot::slotted(*) {\n    \\${this.options ? this.options.style : ''}\n  }\n</style>\n<slot>\n</slot>\n<div class=\"underline\"></div>`;\n\nfunction removeExceptOne(elements, name, index) {\n  if (elements.nodeType === 1) elements = elements.children;\n  for (let j = 0, l = elements.length; j < l; j++) {\n    j === index || elements[j] === index ? elements[j].classList.add(name) : elements[j].classList.remove(name);\n  }\n}\n\nclass SifrrTabHeader extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['options'];\n  }\n\n  onConnect() {\n    this._connected = true;\n    this.$('slot').addEventListener('slotchange', this.refresh.bind(this, {}));\n    this.refresh();\n  }\n\n  onAttributeChange(n, _, v) {\n    if (n === 'options') {\n      this._attrOptions = JSON.parse(v || '{}');\n      if (this._connected) this.refresh();\n    }\n  }\n\n  refresh(options = {}) {\n    this.options = Object.assign({\n      content: this,\n      slot: this.$('slot'),\n      showUnderline: true,\n      line: this.$('.underline'),\n      container: null\n    }, this.options, options, this._attrOptions);\n    this.options.menus = this.options.slot.assignedNodes().filter(n => n.nodeType === 1);\n    if (!this.options.menus || this.options.menus.length < 1) return;\n    this.setProps();\n    this.active = this.active || 0;\n  }\n\n  setProps() {\n    if (!this.options.showUnderline) this.options.line.style.display = 'none';\n    this.setMenuProps();\n    if (this.options.container) {\n      const c = this.options.container;\n      c.onScrollPercent = this.setScrollPercent.bind(this);\n      SifrrDom.Event.addListener('update', c, () => this.active = c.active);\n    }\n  }\n\n  setMenuProps() {\n    let left = 0;\n    this.options.menuProps = [];\n    Array.from(this.options.menus).forEach((elem, i) => {\n      this.options.menuProps[i] = {\n        width: elem.offsetWidth,\n        left: left\n      };\n      left += elem.offsetWidth;\n      elem._click = () => {\n        if (this.options.container) this.options.container.active = i;\n        else this.active = i;\n      };\n    });\n    const last = this.options.menuProps[this.options.menus.length - 1];\n    this.options.totalMenuWidth = last.left + last.width;\n    this.options.slot.style.width = last.left + last.width + 1 * this.options.menuProps.length + 'px';\n    const active = this.options.menuProps[this.active];\n    this.options.line.style.left = active.left + 'px';\n    this.options.line.style.width = active.width + 'px';\n    this.setScrollPercent(0);\n  }\n\n  setScrollPercent(total) {\n    const per = total % 1, t = Math.floor(total);\n    const left = this.options.menuProps[t].left * (1 - per) + (this.options.menuProps[t + 1] || {\n      left: 0\n    }).left * per;\n    const width = this.options.menuProps[t].width * (1 - per) + (this.options.menuProps[t + 1] || {\n      width: 0\n    }).width * per;\n    this.options.line.style.left = left + 'px';\n    this.options.line.style.width = width + 'px';\n    this.scrollLeft = left + (width - this.clientWidth) / 2;\n    if (per === 0) {\n      this._active = t;\n      this.update();\n    }\n  }\n\n  get active() {\n    return this._active || 0;\n  }\n\n  set active(i) {\n    this._active = i;\n    this.setScrollPercent(i);\n    this.update();\n  }\n\n  onUpdate() {\n    if (!this.options) return;\n    removeExceptOne(this.options.menus, 'active', this.active);\n  }\n}\n\nSifrrDom.register(SifrrTabHeader);\nexport default SifrrTabHeader;\n"],"names":["style"],"mappings":"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"}