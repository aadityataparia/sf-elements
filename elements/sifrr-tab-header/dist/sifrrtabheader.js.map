{"version":3,"file":"sifrrtabheader.js","sources":["../src/sifrrtabheader.js"],"sourcesContent":["import SifrrDom from '@sifrr/dom';\nimport style from './style.scss';\n\nconst template = SifrrDom.template`<style media=\"screen\">\n  ${style}\n  slot::slotted(*) {\n    \\${this.options ? this.options.style : ''}\n  }\n  :host {\n    padding-bottom: \\${this.options.showUnderline ? '3px' : '0'};\n  }\n</style>\n<slot>\n</slot>\n<div class=\"underline\"></div>`;\n\nclass SifrrTabHeader extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['options'];\n  }\n\n  onConnect() {\n    this._connected = true;\n    this.$('slot').addEventListener('slotchange', this.refresh.bind(this, {}));\n    this.refresh();\n  }\n\n  onAttributeChange(n, _, v) {\n    if (n === 'options') {\n      this._attrOptions = JSON.parse(v || '{}');\n      if (this._connected) this.refresh();\n    }\n  }\n\n  refresh(options) {\n    this._options = Object.assign({\n      content: this,\n      slot: this.$('slot'),\n      showUnderline: true,\n      line: this.$('.underline'),\n      container: null\n    }, this._options, options);\n    this.options = Object.assign({}, this._options, this._attrOptions);\n    this.options.menus = this.options.slot.assignedNodes().filter(n => n.nodeType === 1);\n    if (!this.options.menus || this.options.menus.length < 1) return;\n    this.setProps();\n    this.active = this.active || 0;\n  }\n\n  setProps() {\n    if (!this.options.showUnderline) this.options.line.style.display = 'none';\n    this.setMenuProps();\n    if (this.options.container) {\n      const c = this.options.container;\n      c.onScrollPercent = this.setScrollPercent.bind(this);\n      SifrrDom.Event.addListener('update', c, () => this.active = c.active);\n    }\n    this.setScrollPercent(0);\n  }\n\n  setMenuProps() {\n    let left = 0;\n    this._smt = this._smt || this.setMenuProps.bind(this);\n    this.options.menuProps = [];\n    Array.from(this.options.menus).forEach((elem, i) => {\n      const width = elem.getBoundingClientRect().width;\n      this.options.menuProps[i] = {\n        width,\n        left: left\n      };\n      left += width;\n      elem.addEventListener('load', this._smt);\n      elem._click = () => {\n        if (this.options.container) this.options.container.active = i;\n        else this.active = i;\n      };\n    });\n    const last = this.options.menuProps[this.options.menus.length - 1];\n    this.options.totalMenuWidth = last.left + last.width;\n    this.$('slot').style.width = this.options.slot.style.width = this.options.totalMenuWidth + 'px';\n  }\n\n  setScrollPercent(total) {\n    const per = total % 1, t = Math.floor(total);\n    const left = this.options.menuProps[t].left * (1 - per) + (this.options.menuProps[t + 1] || {\n      left: 0\n    }).left * per;\n    const width = this.options.menuProps[t].width * (1 - per) + (this.options.menuProps[t + 1] || {\n      width: 0\n    }).width * per;\n    this.options.line.style.left = left + 'px';\n    this.options.line.style.width = width + 'px';\n    this.scrollLeft = left + (width - this.clientWidth) / 2;\n    if (per === 0) {\n      this._active = t;\n      this.update();\n    }\n  }\n\n  get active() {\n    return this._active || 0;\n  }\n\n  set active(i) {\n    this._active = i;\n    this.setScrollPercent(i);\n    this.update();\n  }\n\n  onUpdate() {\n    if (!this.options) return;\n    for (let j = 0, l = this.options.menus.length; j < l; j++) {\n      this.options.menus[j].classList[j === this.active ? 'add' : 'remove']('active');\n    }\n  }\n}\n\nSifrrDom.register(SifrrTabHeader);\nexport default SifrrTabHeader;\n"],"names":["template","SifrrDom","style","SifrrTabHeader","Element","observedAttrs","onConnect","_connected","$","addEventListener","refresh","bind","onAttributeChange","n","_","v","_attrOptions","JSON","parse","options","_options","Object","assign","content","slot","showUnderline","line","container","menus","assignedNodes","filter","nodeType","length","setProps","active","display","setMenuProps","c","onScrollPercent","setScrollPercent","Event","addListener","left","_smt","menuProps","Array","from","forEach","elem","i","width","getBoundingClientRect","_click","last","totalMenuWidth","total","per","t","Math","floor","scrollLeft","clientWidth","_active","update","onUpdate","j","l","classList","register"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,EAGA,MAAMA,QAAQ,GAAGC,QAAQ,CAACD,QAAZ,oBACVE,GADU,CAAd;EAaA,MAAMC,cAAN,SAA6BF,QAAQ,CAACG,OAAtC,CAA8C;EAC5C,aAAWJ,QAAX,GAAsB;EACpB,WAAOA,QAAP;EACD;EAED,SAAOK,aAAP,GAAuB;EACrB,WAAO,CAAC,SAAD,CAAP;EACD;EAEDC,EAAAA,SAAS,GAAG;EACV,SAAKC,UAAL,GAAkB,IAAlB;EACA,SAAKC,CAAL,CAAO,MAAP,EAAeC,gBAAf,CAAgC,YAAhC,EAA8C,KAAKC,OAAL,CAAaC,IAAb,CAAkB,IAAlB,EAAwB,EAAxB,CAA9C;EACA,SAAKD,OAAL;EACD;EAEDE,EAAAA,iBAAiB,CAACC,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAU;EACzB,QAAIF,CAAC,KAAK,SAAV,EAAqB;EACnB,WAAKG,YAAL,GAAoBC,IAAI,CAACC,KAAL,CAAWH,CAAC,IAAI,IAAhB,CAApB;EACA,UAAI,KAAKR,UAAT,EAAqB,KAAKG,OAAL;EACtB;EACF;EAEDA,EAAAA,OAAO,CAACS,OAAD,EAAU;EACf,SAAKC,QAAL,GAAgBC,MAAM,CAACC,MAAP,CAAc;EAC5BC,MAAAA,OAAO,EAAE,IADmB;EAE5BC,MAAAA,IAAI,EAAE,KAAKhB,CAAL,CAAO,MAAP,CAFsB;EAG5BiB,MAAAA,aAAa,EAAE,IAHa;EAI5BC,MAAAA,IAAI,EAAE,KAAKlB,CAAL,CAAO,YAAP,CAJsB;EAK5BmB,MAAAA,SAAS,EAAE;EALiB,KAAd,EAMb,KAAKP,QANQ,EAMED,OANF,CAAhB;EAOA,SAAKA,OAAL,GAAeE,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,KAAKF,QAAvB,EAAiC,KAAKJ,YAAtC,CAAf;EACA,SAAKG,OAAL,CAAaS,KAAb,GAAqB,KAAKT,OAAL,CAAaK,IAAb,CAAkBK,aAAlB,GAAkCC,MAAlC,CAAyCjB,CAAC,IAAIA,CAAC,CAACkB,QAAF,KAAe,CAA7D,CAArB;EACA,QAAI,CAAC,KAAKZ,OAAL,CAAaS,KAAd,IAAuB,KAAKT,OAAL,CAAaS,KAAb,CAAmBI,MAAnB,GAA4B,CAAvD,EAA0D;EAC1D,SAAKC,QAAL;EACA,SAAKC,MAAL,GAAc,KAAKA,MAAL,IAAe,CAA7B;EACD;EAEDD,EAAAA,QAAQ,GAAG;EACT,QAAI,CAAC,KAAKd,OAAL,CAAaM,aAAlB,EAAiC,KAAKN,OAAL,CAAaO,IAAb,CAAkBxB,KAAlB,CAAwBiC,OAAxB,GAAkC,MAAlC;EACjC,SAAKC,YAAL;EACA,QAAI,KAAKjB,OAAL,CAAaQ,SAAjB,EAA4B;EAC1B,YAAMU,CAAC,GAAG,KAAKlB,OAAL,CAAaQ,SAAvB;EACAU,MAAAA,CAAC,CAACC,eAAF,GAAoB,KAAKC,gBAAL,CAAsB5B,IAAtB,CAA2B,IAA3B,CAApB;EACAV,MAAAA,QAAQ,CAACuC,KAAT,CAAeC,WAAf,CAA2B,QAA3B,EAAqCJ,CAArC,EAAwC,MAAM,KAAKH,MAAL,GAAcG,CAAC,CAACH,MAA9D;EACD;EACD,SAAKK,gBAAL,CAAsB,CAAtB;EACD;EAEDH,EAAAA,YAAY,GAAG;EACb,QAAIM,IAAI,GAAG,CAAX;EACA,SAAKC,IAAL,GAAY,KAAKA,IAAL,IAAa,KAAKP,YAAL,CAAkBzB,IAAlB,CAAuB,IAAvB,CAAzB;EACA,SAAKQ,OAAL,CAAayB,SAAb,GAAyB,EAAzB;EACAC,IAAAA,KAAK,CAACC,IAAN,CAAW,KAAK3B,OAAL,CAAaS,KAAxB,EAA+BmB,OAA/B,CAAuC,CAACC,IAAD,EAAOC,CAAP,KAAa;EAClD,YAAMC,KAAK,GAAGF,IAAI,CAACG,qBAAL,GAA6BD,KAA3C;EACA,WAAK/B,OAAL,CAAayB,SAAb,CAAuBK,CAAvB,IAA4B;EAC1BC,QAAAA,KAD0B;EAE1BR,QAAAA,IAAI,EAAEA;EAFoB,OAA5B;EAIAA,MAAAA,IAAI,IAAIQ,KAAR;EACAF,MAAAA,IAAI,CAACvC,gBAAL,CAAsB,MAAtB,EAA8B,KAAKkC,IAAnC;EACAK,MAAAA,IAAI,CAACI,MAAL,GAAc,MAAM;EAClB,YAAI,KAAKjC,OAAL,CAAaQ,SAAjB,EAA4B,KAAKR,OAAL,CAAaQ,SAAb,CAAuBO,MAAvB,GAAgCe,CAAhC,CAA5B,KACK,KAAKf,MAAL,GAAce,CAAd;EACN,OAHD;EAID,KAZD;EAaA,UAAMI,IAAI,GAAG,KAAKlC,OAAL,CAAayB,SAAb,CAAuB,KAAKzB,OAAL,CAAaS,KAAb,CAAmBI,MAAnB,GAA4B,CAAnD,CAAb;EACA,SAAKb,OAAL,CAAamC,cAAb,GAA8BD,IAAI,CAACX,IAAL,GAAYW,IAAI,CAACH,KAA/C;EACA,SAAK1C,CAAL,CAAO,MAAP,EAAeN,KAAf,CAAqBgD,KAArB,GAA6B,KAAK/B,OAAL,CAAaK,IAAb,CAAkBtB,KAAlB,CAAwBgD,KAAxB,GAAgC,KAAK/B,OAAL,CAAamC,cAAb,GAA8B,IAA3F;EACD;EAEDf,EAAAA,gBAAgB,CAACgB,KAAD,EAAQ;EACtB,UAAMC,GAAG,GAAGD,KAAK,GAAG,CAApB;EAAA,UAAuBE,CAAC,GAAGC,IAAI,CAACC,KAAL,CAAWJ,KAAX,CAA3B;EACA,UAAMb,IAAI,GAAG,KAAKvB,OAAL,CAAayB,SAAb,CAAuBa,CAAvB,EAA0Bf,IAA1B,IAAkC,IAAIc,GAAtC,IAA6C,CAAC,KAAKrC,OAAL,CAAayB,SAAb,CAAuBa,CAAC,GAAG,CAA3B,KAAiC;EAC1Ff,MAAAA,IAAI,EAAE;EADoF,KAAlC,EAEvDA,IAFuD,GAEhDc,GAFV;EAGA,UAAMN,KAAK,GAAG,KAAK/B,OAAL,CAAayB,SAAb,CAAuBa,CAAvB,EAA0BP,KAA1B,IAAmC,IAAIM,GAAvC,IAA8C,CAAC,KAAKrC,OAAL,CAAayB,SAAb,CAAuBa,CAAC,GAAG,CAA3B,KAAiC;EAC5FP,MAAAA,KAAK,EAAE;EADqF,KAAlC,EAEzDA,KAFyD,GAEjDM,GAFX;EAGA,SAAKrC,OAAL,CAAaO,IAAb,CAAkBxB,KAAlB,CAAwBwC,IAAxB,GAA+BA,IAAI,GAAG,IAAtC;EACA,SAAKvB,OAAL,CAAaO,IAAb,CAAkBxB,KAAlB,CAAwBgD,KAAxB,GAAgCA,KAAK,GAAG,IAAxC;EACA,SAAKU,UAAL,GAAkBlB,IAAI,GAAG,CAACQ,KAAK,GAAG,KAAKW,WAAd,IAA6B,CAAtD;EACA,QAAIL,GAAG,KAAK,CAAZ,EAAe;EACb,WAAKM,OAAL,GAAeL,CAAf;EACA,WAAKM,MAAL;EACD;EACF;EAED,MAAI7B,MAAJ,GAAa;EACX,WAAO,KAAK4B,OAAL,IAAgB,CAAvB;EACD;EAED,MAAI5B,MAAJ,CAAWe,CAAX,EAAc;EACZ,SAAKa,OAAL,GAAeb,CAAf;EACA,SAAKV,gBAAL,CAAsBU,CAAtB;EACA,SAAKc,MAAL;EACD;EAEDC,EAAAA,QAAQ,GAAG;EACT,QAAI,CAAC,KAAK7C,OAAV,EAAmB;EACnB,SAAK,IAAI8C,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAG,KAAK/C,OAAL,CAAaS,KAAb,CAAmBI,MAAvC,EAA+CiC,CAAC,GAAGC,CAAnD,EAAsDD,CAAC,EAAvD,EAA2D;EACzD,WAAK9C,OAAL,CAAaS,KAAb,CAAmBqC,CAAnB,EAAsBE,SAAtB,CAAgCF,CAAC,KAAK,KAAK/B,MAAX,GAAoB,KAApB,GAA4B,QAA5D,EAAsE,QAAtE;EACD;EACF;EAtG2C;EAyG9CjC,QAAQ,CAACmE,QAAT,CAAkBjE,cAAlB;;;;;;;;;;;"}