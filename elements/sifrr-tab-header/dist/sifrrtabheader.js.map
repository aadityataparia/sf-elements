{"version":3,"file":"sifrrtabheader.js","sources":["../src/sifrrtabheader.js"],"sourcesContent":["import SifrrDom from '@sifrr/dom';\nimport style from './style.scss';\n\nconst template = SifrrDom.template`<style media=\"screen\">\n  ${style}\n  slot::slotted(*) {\n    \\${this.options ? this.options.style : ''}\n  }\n</style>\n<slot>\n</slot>\n<div class=\"underline\"></div>`;\n\nclass SifrrTabHeader extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['options'];\n  }\n\n  onConnect() {\n    this._connected = true;\n    this.$('slot').addEventListener('slotchange', this.refresh.bind(this, {}));\n    this.refresh();\n  }\n\n  onAttributeChange(n, _, v) {\n    if (n === 'options') {\n      this._attrOptions = JSON.parse(v || '{}');\n      if (this._connected) this.refresh();\n    }\n  }\n\n  refresh(options) {\n    this.options = Object.assign({\n      content: this,\n      slot: this.$('slot'),\n      showUnderline: true,\n      line: this.$('.underline'),\n      container: null\n    }, this.options, options, this._attrOptions);\n    this.options.menus = this.options.slot.assignedNodes().filter(n => n.nodeType === 1);\n    if (!this.options.menus || this.options.menus.length < 1) return;\n    this.setProps();\n    this.active = this.active || 0;\n  }\n\n  setProps() {\n    if (!this.options.showUnderline) this.options.line.style.display = 'none';\n    this.setMenuProps();\n    if (this.options.container) {\n      const c = this.options.container;\n      c.onScrollPercent = this.setScrollPercent.bind(this);\n      SifrrDom.Event.addListener('update', c, () => this.active = c.active);\n    }\n    this.setScrollPercent(0);\n  }\n\n  setMenuProps() {\n    let left = 0;\n    this.options.menuProps = [];\n    Array.from(this.options.menus).forEach((elem, i) => {\n      this.options.menuProps[i] = {\n        width: elem.offsetWidth,\n        left: left\n      };\n      left += elem.offsetWidth;\n      elem._click = () => {\n        if (this.options.container) this.options.container.active = i;\n        else this.active = i;\n      };\n    });\n    const last = this.options.menuProps[this.options.menus.length - 1];\n    this.options.totalMenuWidth = last.left + last.width;\n    this.$('slot').style.width = this.options.slot.style.width = last.left + last.width + 1 * this.options.menuProps.length + 'px';\n  }\n\n  setScrollPercent(total) {\n    const per = total % 1, t = Math.floor(total);\n    const left = this.options.menuProps[t].left * (1 - per) + (this.options.menuProps[t + 1] || {\n      left: 0\n    }).left * per;\n    const width = this.options.menuProps[t].width * (1 - per) + (this.options.menuProps[t + 1] || {\n      width: 0\n    }).width * per;\n    this.options.line.style.left = left + 'px';\n    this.options.line.style.width = width + 'px';\n    this.scrollLeft = left + (width - this.clientWidth) / 2;\n    if (per === 0) {\n      this._active = t;\n      this.update();\n    }\n  }\n\n  get active() {\n    return this._active || 0;\n  }\n\n  set active(i) {\n    this._active = i;\n    this.setScrollPercent(i);\n    this.update();\n  }\n\n  onUpdate() {\n    if (!this.options) return;\n    for (let j = 0, l = this.options.menus.length; j < l; j++) {\n      this.options.menus[j].classList[j === this.active ? 'add' : 'remove']('active');\n    }\n    this.setMenuProps();\n  }\n}\n\nSifrrDom.register(SifrrTabHeader);\nexport default SifrrTabHeader;\n"],"names":["template","SifrrDom","style","SifrrTabHeader","Element","observedAttrs","onConnect","_connected","$","addEventListener","refresh","bind","onAttributeChange","n","_","v","_attrOptions","JSON","parse","options","Object","assign","content","slot","showUnderline","line","container","menus","assignedNodes","filter","nodeType","length","setProps","active","display","setMenuProps","c","onScrollPercent","setScrollPercent","Event","addListener","left","menuProps","Array","from","forEach","elem","i","width","offsetWidth","_click","last","totalMenuWidth","total","per","t","Math","floor","scrollLeft","clientWidth","_active","update","onUpdate","j","l","classList","register"],"mappings":"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"}