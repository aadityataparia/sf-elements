{"version":3,"file":"sifrrtabheader.js","sources":["../src/sifrrtabheader.js"],"sourcesContent":["import SifrrDom from '@sifrr/dom';\nimport style from './style.scss';\n\nconst template = SifrrDom.template`<style media=\"screen\">\n  ${style}\n  slot::slotted(*) {\n    \\${this.options ? this.options.style : ''}\n  }\n  :host {\n    padding-bottom: \\${this.options && this.options.showUnderline ? '3px' : '0'};\n  }\n</style>\n<slot>\n</slot>\n<div class=\"underline\"></div>`;\n\nclass SifrrTabHeader extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['options'];\n  }\n\n  onConnect() {\n    this._connected = true;\n    this.$('slot').addEventListener('slotchange', this.refresh.bind(this, {}));\n    this.refresh();\n  }\n\n  onAttributeChange(n, _, v) {\n    if (n === 'options') {\n      this._attrOptions = JSON.parse(v || '{}');\n      if (this._connected) this.refresh();\n    }\n  }\n\n  refresh(options) {\n    this._options = Object.assign(\n      {\n        content: this,\n        slot: this.$('slot'),\n        showUnderline: true,\n        line: this.$('.underline'),\n        container: null\n      },\n      this._options,\n      options\n    );\n    this.options = Object.assign({}, this._options, this._attrOptions);\n    this.options.menus = this.options.slot.assignedNodes().filter(n => n.nodeType === 1);\n    if (!this.options.menus || this.options.menus.length < 1) return;\n    this.setProps();\n    this.active = this.active || 0;\n  }\n\n  setProps() {\n    if (!this.options.showUnderline) this.options.line.style.display = 'none';\n    this.setMenuProps();\n    if (this.options.container) {\n      const c = this.options.container;\n      c.onScrollPercent = this.setScrollPercent.bind(this);\n      SifrrDom.Event.addListener('update', c, () => (this.active = c.active));\n    }\n    this.setScrollPercent(0);\n  }\n\n  setMenuProps() {\n    let left = 0;\n    this.options.menuProps = [];\n    Array.from(this.options.menus).forEach((elem, i) => {\n      const width = elem.getBoundingClientRect().width;\n      this.options.menuProps[i] = {\n        width,\n        left: left\n      };\n      left += width;\n      elem._click = () => {\n        if (this.options.container) this.options.container.active = i;\n        else this.active = i;\n      };\n    });\n    const last = this.options.menuProps[this.options.menus.length - 1];\n    this.options.totalMenuWidth = last.left + last.width;\n    this.$('slot').style.width = this.options.slot.style.width =\n      this.options.totalMenuWidth + 1 + 'px';\n  }\n\n  setScrollPercent(total) {\n    const per = total % 1,\n      t = Math.floor(total);\n    const left =\n      this.options.menuProps[t].left * (1 - per) +\n      (\n        this.options.menuProps[t + 1] || {\n          left: 0\n        }\n      ).left *\n        per;\n    const width =\n      this.options.menuProps[t].width * (1 - per) +\n      (\n        this.options.menuProps[t + 1] || {\n          width: 0\n        }\n      ).width *\n        per;\n    this.options.line.style.left = left + 'px';\n    this.options.line.style.width = width + 'px';\n    this.scrollLeft = left + (width - this.clientWidth) / 2;\n    if (per === 0) {\n      this._active = t;\n      this.update();\n    }\n  }\n\n  get active() {\n    return this._active || 0;\n  }\n\n  set active(i) {\n    this._active = i;\n    this.setScrollPercent(i);\n    this.update();\n  }\n\n  onUpdate() {\n    if (!this.options) return;\n    for (let j = 0, l = this.options.menus.length; j < l; j++) {\n      this.options.menus[j].classList[j === this.active ? 'add' : 'remove']('active');\n    }\n  }\n}\n\nSifrrDom.register(SifrrTabHeader);\nexport default SifrrTabHeader;\n"],"names":["template","SifrrDom","style","SifrrTabHeader","Element","observedAttrs","onConnect","_connected","$","addEventListener","refresh","bind","onAttributeChange","n","_","v","_attrOptions","JSON","parse","options","_options","Object","assign","content","slot","showUnderline","line","container","menus","assignedNodes","filter","nodeType","length","setProps","active","display","setMenuProps","c","onScrollPercent","setScrollPercent","Event","addListener","left","menuProps","Array","from","forEach","elem","i","width","getBoundingClientRect","_click","last","totalMenuWidth","total","per","t","Math","floor","scrollLeft","clientWidth","_active","update","onUpdate","j","l","classList","register"],"mappings":"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"}