{"version":3,"file":"sifrrshowcase.js","sources":["../../sifrr-code-editor/src/sifrrcodeeditor.js","../src/singleshowcase.js","../src/sifrrshowcase.js"],"sourcesContent":["import SifrrDom from '@sifrr/dom';\nimport style from './style.scss';\n\nconst template = SifrrDom.template`\n<style media=\"screen\">\n  ${style}\n</style>\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/\\${this.theme}.min.css\">\n<pre class='hljs'>\n  <code id=\"highlight\" data-sifrr-html=\"true\">\n    \\${this.htmlValue}\n  </code>\n</pre>\n<textarea class='hljs' _input=\"\\${this.input}\"></textarea>`;\n\nclass SifrrCodeEditor extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['value', 'theme'];\n  }\n\n  static hljs() {\n    this._hljs = this._hljs || fetch('https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js')\n      .then(resp => resp.text())\n      .then(text => new Function(text)());\n    return this._hljs;\n  }\n\n  onAttributeChange() {\n    this.update();\n  }\n\n  onConnect() {\n    this.constructor.hljs().then(() => this.hljsLoaded());\n\n    const txtarea = this.$('textarea');\n    txtarea.addEventListener('keydown', (e) => {\n      let keyCode = e.keyCode || e.which;\n      this.$('#highlight').style.height = this.$('textarea').height;\n      if (keyCode == 9) {\n        e.preventDefault();\n        const start = txtarea.selectionStart;\n        const end = txtarea.selectionEnd;\n\n        const tabCharacter = '  ';\n        const tabOffset = 2;\n\n        // set textarea value to: text before caret + tab + text after caret\n        txtarea.value = txtarea.value.substring(0, start) + tabCharacter + txtarea.value.substring(end);\n\n        // put caret at right position again\n        txtarea.selectionStart = txtarea.selectionEnd = start + tabOffset;\n\n        this.update();\n      }\n    });\n    txtarea.onscroll = () => {\n      this.$('pre.hljs').scrollTop = txtarea.scrollTop;\n    };\n  }\n\n  input() {\n    SifrrDom.Event.trigger(this, 'input');\n    this.update();\n  }\n\n  hljsLoaded() {\n    this.$('textarea').classList.add('loaded');\n    this.update();\n  }\n\n  get htmlValue() {\n    if (window.hljs) return window.hljs.highlight(this.lang, this.value.replace(/\\n$/, '\\n\\n')).value;\n    else return this.value.replace(/</g, '&lt;');\n  }\n\n  get theme() {\n    return this.getAttribute('theme') || 'atom-one-dark';\n  }\n\n  set theme(v) {\n    this.setAttribute('theme', v);\n    this.update();\n  }\n\n  get value() {\n    return this.$('textarea').value;\n  }\n\n  set value(v) {\n    this.$('textarea').value = v;\n    this.update();\n  }\n\n  get lang() {\n    return this.getAttribute('lang') || 'html';\n  }\n}\n\nSifrrDom.register(SifrrCodeEditor);\n\nexport default SifrrCodeEditor;\n","import SifrrDom from '@sifrr/dom';\nimport style from './style.scss';\nimport html from './template.html';\nimport '../../sifrr-code-editor/src/sifrrcodeeditor';\n\nconst template = SifrrDom.template`<style media=\"screen\">\n  ${style}\n</style>\n<style>\n\\${this.state.style}\n</style>\n${html}`;\n\nSifrrDom.Event.add('click');\n\nconst defaultShowcase = {\n  id: 1,\n  name: 'Placeholder Element',\n  element: 'sifrr-placeholder',\n  elementUrl: '',\n  isjs: true,\n  variantName: '',\n  variants: [\n    {\n      variantId: 1,\n      variantName: 'variant',\n      style: `#element > * {\n  display: block;\n  background-color: white;\n  margin: auto;\n}`,\n      code: '<sifrr-placeholder>\\n</sifrr-placeholder>',\n      elState: 'return {\\n\\n}'\n    }\n  ]\n};\n\nclass SifrrSingleShowcase extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['url'];\n  }\n\n  onConnect() {\n    this.switchVariant();\n    SifrrDom.Event.addListener('click', '.variant', (e, el) => {\n      if (el.matches('.variant')) this.switchVariant(el.dataset.variantId);\n      if (el.matches('.variant span')) this.deleteVariant(el.parentNode.dataset.variantId);\n    });\n  }\n\n  beforeUpdate() {\n    this.saveVariant();\n    if (!this.state.elemnt) return;\n    if (this._element !== this.state.element || this._js !== this.state.isjs || this._url !== this.state.elementUrl) {\n      SifrrDom.load(this.state.element, {\n        js: this.state.isjs == 'true',\n        url: this.state.elementUrl ? this.state.elementUrl : undefined\n      }).then(() => this.$('#error').innerText = '').catch(e => this.$('#error').innerText = e.message);\n      this._js = this.state.isjs;\n      this._element = this.state.element;\n      this._url = this.state.elementUrl;\n    }\n  }\n\n  onUpdate() {\n    if (this._stateFxnTimeout) clearTimeout(this._stateFxnTimeout);\n    this._stateFxnTimeout = setTimeout(this.runStateFunction.bind(this), 500);\n  }\n\n  runStateFunction() {\n    let state;\n    try {\n      state = new Function(this.$('#elState').value).call(this.element());\n    } catch (e) { window.console.warn(e); }\n    if (state && this.element() && this.element().isSifrr && this.element().state !== state) {\n      this.element().state = state;\n    }\n  }\n\n  onAttributeChange(name, _, value) {\n    if (name === 'url') this.url = value;\n  }\n\n  createNewVariant() {\n    const id = Math.max(...this.state.variants.map(s => s.variantId), 0) + 1;\n    const cid = this.state.variants.findIndex(v => v.variantId == this.state.variantId) + 1 || 1;\n    this.state.variants.splice(cid, 0, Object.assign({}, {\n      variantId: id,\n      variantName: this.state.variantName,\n      style: this.state.style || '',\n      code: this.state.code || '',\n      elState: this.state.elState || ''\n    }));\n    this.switchVariant(id);\n  }\n\n  deleteVariant(id) {\n    this.state.variants.forEach((s, i) => {\n      if (s.variantId == id) {\n        this.state.variants.splice(i, 1);\n        if (this.state.variantId == id) this.switchVariant((this.state.variants[i] || {}).variantId);\n        else this.update();\n      }\n    });\n  }\n\n  saveVariant() {\n    if (!this.state.variants) this.state.variants = [];\n    const id = this.state.variantId;\n    this.state.variants.forEach(s => {\n      if (s.variantId == id) {\n        Object.assign(s, {\n          variantName: this.state.variantName,\n          style: this.state.style,\n          code: this.state.code,\n          elState: this.state.elState\n        });\n      }\n    });\n  }\n\n  switchVariant(id) {\n    Object.assign(this.state, this.variant(id));\n    this.update();\n  }\n\n  updateHtml(e, el) {\n    const html = `<${el.value}></${el.value}>`;\n    this.state = { code: html, element: el.value };\n  }\n\n  element() {\n    return this.$('#element').firstElementChild;\n  }\n\n  variant(id) {\n    return this.state.variants.find(s => s.variantId == id) || this.state.variants[this.state.variants.length - 1];\n  }\n}\n\nSifrrSingleShowcase.defaultState = defaultShowcase;\n\nSifrrDom.register(SifrrSingleShowcase);\n\nexport default SifrrSingleShowcase;\n","import SifrrDom from '@sifrr/dom';\nimport SifrrStorage from '@sifrr/storage';\nimport style from './style.scss';\nimport './singleshowcase';\n\nconst template = SifrrDom.template`<style media=\"screen\">\n  ${style}\n</style>\n<div class=\"container\">\n  <div class=\"flex-column\" id=\"sidemenu\">\n    <div class=\"box\">\n      <h1 class=\"font head\">Sifrr Showcase</h1>\n      <p class=\"font\" id=\"loader\"></p>\n      <input id=\"url\" type=\"text\" placeholder=\"Enter url here...\" name=\"url\" />\n      <button type=\"button\" name=\"loadUrl\" _click=\\${this.loadUrl}>Load from url</button>\n      <p class=\"font\" id=\"status\"></p>\n      <span class=\"button font\">\n        Upload File\n        <input type=\"file\" name=\"file\" accept=\"application/json\" _input=\"\\${this.loadFile}\" />\n      </span>\n      <button class=\"font\" type=\"button\" name=\"saveFile\" _click=\"\\${this.saveFile}\">Save to File</button>\n      <h3 class=\"font head\">Showcases</h3>\n      <input id=\"showcaseName\" type=\"text\" name=\"showcase\" _input=\\${this.changeName} value=\\${this.state.showcases[this.state.current].name}>\n      <button class=\"font\" type=\"button\" name=\"createVariant\" _click=\"\\${this.createShowcase}\">Create new showcase</button>\n      <div id=\"showcases\" data-sifrr-repeat=\"\\${this.state.showcases}\">\n        <li class=\"font showcase small \\${this.state.id === this._root.state.currentSC.id ? 'current' : ''}\" data-showcase-id=\"\\${this.state.key}\" draggable=\"true\">\\${this.state.name}<span>X</span></li>\n      </div>\n    </div>\n  </div>\n  <sifrr-single-showcase _update=\\${this.saveShowcase} _state=\\${this.state.currentSC} data-sifrr-bind=\"currentSC\"></sifrr-single-showcase>\n</div>`;\n\nconst storage = new SifrrStorage({ name: 'showcases', version: '1.0' });\n\nclass SifrrShowcase extends SifrrDom.Element {\n  static get template() {\n    return template;\n  }\n\n  static observedAttrs() {\n    return ['url'];\n  }\n\n  onAttributeChange(n, _, value) {\n    if (n === 'url') this.url = value;\n  }\n\n  onConnect() {\n    SifrrDom.Event.addListener('click', '.showcase', (e, el) => {\n      if (el.matches('.showcase')) this.switchShowcase(this.getChildIndex(el));\n      if (el.matches('.showcase span')) this.deleteShowcase(this.getChildIndex(el.parentNode));\n    });\n    this.loadUrl();\n    this.switchShowcase(0);\n    if (window.Sortable) {\n      const me = this;\n      new window.Sortable(this.$('#showcases'), {\n        draggable: 'li',\n        onEnd: (e) => {\n          const o = e.oldIndex, n = e.newIndex;\n          const old = me.state.showcases[o];\n          me.state.showcases[o] = me.state.showcases[n];\n          me.state.showcases[n] = old;\n          const current = me.$('#showcases .current');\n          me.switchShowcase(me.getChildIndex(current));\n        }\n      });\n    }\n  }\n\n  getChildIndex(el) {\n    let i = 0;\n    while((el = el.previousElementSibling) != null) i++;\n    return i;\n  }\n\n  deleteShowcase(i) {\n    this.state.showcases.splice(i, 1);\n    if (i == this.state.current) this.switchShowcase(this.state.current);\n    else this.switchShowcase(this.state.current - 1);\n  }\n\n  createShowcase() {\n    this.state.showcases.splice(this.state.current + 1, 0, {\n      name: this.$('#showcaseName').value,\n      variants: [],\n      element: this.$('#showcaseName').value\n    });\n    this.switchShowcase(this.state.current + 1);\n  }\n\n  switchShowcase(i) {\n    this.current = i;\n    this.$('#showcases').children[this.state.current].classList.remove('current');\n    if (!this.state.showcases[i]) i = this.state.showcases.length - 1;\n    this.state = { current: i, currentSC: this.state.showcases[i] };\n    this.$('#showcases').children[i].classList.add('current');\n  }\n\n  onStateChange() {\n    if (this.state.current !== this.current) this.switchShowcase(this.state.current);\n  }\n\n  saveShowcase() {\n    this.state.showcases[this.state.current] = Object.assign(this.state.showcases[this.state.current], this.state.currentSC);\n    if (this._loaded) {\n      this.$('#status').textContent = 'saving locally!';\n      if (this._timeout) clearTimeout(this._timeout);\n      this._timeout = setTimeout(() => {\n        this._timeout = null;\n        storage.set({ showcases: this.state.showcases, current: this.state.current }).then(() => {\n          this.$('#status').textContent = 'saved locally!';\n        });\n      }, 500);\n    }\n  }\n\n  changeName() {\n    this.state.showcases[this.state.current].name = this.$('#showcaseName').value;\n    this.update();\n  }\n\n  get el() {\n    return this.$('sifrr-single-showcase');\n  }\n\n  set url(v) {\n    this._url = v;\n    if (this.getAttribute('url') !== v) this.setAttribute('url', v);\n    if (this.$('#url').value !== v) this.$('#url').value = v;\n    this.loadUrl();\n  }\n\n  get url() {\n    return this._url;\n  }\n\n  loadUrl() {\n    this._url = this.$('#url').value;\n    window.fetch(this._url).then((resp) => resp.json()).then(v => {\n      this.state.showcases = v.showcases;\n      this.switchShowcase(v.current);\n      this.$('#status').textContent = 'loaded from url!';\n    }).catch((e) => {\n      this.$('#status').textContent = e.message;\n      storage.all().then(v => {\n        this.$('#status').textContent = 'failed to load from url, loaded from storage!';\n        this._loaded = true;\n        if (Array.isArray(v.showcases)) {\n          this.state.showcases = v.showcases;\n          this.switchShowcase(v.current);\n        }\n      });\n    });\n  }\n\n  saveFile() {\n    const blob = new Blob([JSON.stringify(this.state, null, 2)], {\n      type: 'application/json'\n    });\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = 'showcases';\n    a.click();\n  }\n\n  loadFile(e, el) {\n    const file = el.files[0];\n    const fr = new FileReader();\n    fr.onload = () => {\n      const json = JSON.parse(fr.result);\n      this.state = json;\n      this.switchShowcase(json.current);\n      this.$('#status').textContent = 'loaded from file!';\n    };\n    fr.readAsText(file);\n  }\n}\n\nSifrrShowcase.defaultState = {\n  current: 0,\n  showcases: [{\n    name: 'new'\n  }]\n};\n\nSifrrDom.register(SifrrShowcase);\n\nexport default SifrrShowcase;\n"],"names":["template","SifrrDom","style","SifrrCodeEditor","Element","observedAttrs","hljs","_hljs","fetch","then","resp","text","Function","onAttributeChange","update","onConnect","constructor","hljsLoaded","txtarea","$","addEventListener","e","keyCode","which","height","preventDefault","start","selectionStart","end","selectionEnd","tabCharacter","tabOffset","value","substring","onscroll","scrollTop","input","Event","trigger","classList","add","htmlValue","window","highlight","lang","replace","theme","getAttribute","v","setAttribute","register","html","defaultShowcase","id","name","element","elementUrl","isjs","variantName","variants","variantId","code","elState","SifrrSingleShowcase","switchVariant","addListener","el","matches","dataset","deleteVariant","parentNode","beforeUpdate","saveVariant","state","elemnt","_element","_js","_url","load","js","url","undefined","innerText","catch","message","onUpdate","_stateFxnTimeout","clearTimeout","setTimeout","runStateFunction","bind","call","console","warn","isSifrr","_","createNewVariant","Math","max","map","s","cid","findIndex","splice","Object","assign","forEach","i","variant","updateHtml","firstElementChild","find","length","defaultState","storage","SifrrStorage","version","SifrrShowcase","n","switchShowcase","getChildIndex","deleteShowcase","loadUrl","Sortable","me","draggable","onEnd","o","oldIndex","newIndex","old","showcases","current","previousElementSibling","createShowcase","children","remove","currentSC","onStateChange","saveShowcase","_loaded","textContent","_timeout","set","changeName","json","all","Array","isArray","saveFile","blob","Blob","JSON","stringify","type","a","document","createElement","href","URL","createObjectURL","download","click","loadFile","file","files","fr","FileReader","onload","parse","result","readAsText"],"mappings":"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"}