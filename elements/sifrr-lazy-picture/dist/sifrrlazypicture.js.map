{"version":3,"file":"sifrrlazypicture.js","sources":["../../../helpers/lazyloader.js","../src/sifrrlazypicture.js"],"sourcesContent":["function moveAttr(el, attr) {\n  if (!el.dataset[attr]) return;\n  el.setAttribute(attr, el.dataset[attr]);\n  el.removeAttribute(`data-${attr}`);\n}\n\nfunction loadPicture(pic) {\n  if (pic.tagName === 'PICTURE') {\n    pic.querySelectorAll('source').forEach((s) => {\n      moveAttr(s, 'src');\n      moveAttr(s, 'srcset');\n    });\n    pic = pic.querySelector('img');\n  } else if (pic.tagName !== 'IMG') {\n    throw Error('LazyLoader only supports `picture` or `img` element. Given: ', pic);\n  }\n  moveAttr(pic, 'src');\n  moveAttr(pic, 'srcset');\n  return true;\n}\n\nfunction onVisible(entries) {\n  entries.forEach(entry => {\n    if (entry.isIntersecting && !entry.target._loaded) {\n      entry.target._loaded = true;\n      if (entry.target.beforeLoad) entry.target.beforeLoad();\n      loadPicture(entry.target);\n      this.unobserve(entry.target);\n      if (entry.target.afterLoad) entry.target.afterLoad();\n    }\n  });\n}\n\nclass LazyLoader extends window.IntersectionObserver {\n  constructor(rootMargin = '0px 0px 0px 0px') {\n    super(onVisible, { rootMargin });\n  }\n}\n\nLazyLoader.prototype._observe = LazyLoader.prototype.observe;\nLazyLoader.prototype.observe = function(el) {\n  el._loaded = false;\n  this._observe(el);\n};\n\nexport default LazyLoader;\n","import SifrrDom from '@sifrr/dom';\nimport LazyLoader from '../../../helpers/lazyloader';\n\nclass SifrrLazyPicture extends SifrrDom.Element.extends(HTMLPictureElement) {\n  static get observer() {\n    this._observer = this._observer || new LazyLoader(this.rootMargin);\n    return this._observer;\n  }\n\n  onConnect() {\n    this.reload();\n  }\n\n  reload() {\n    this.constructor.observer.observe(this);\n  }\n\n  onDisconnect() {\n    this.constructor.observer.unobserve(this);\n  }\n}\n\nSifrrLazyPicture.rootMargin = '0px 0px 50px 0px';\n\nSifrrDom.register(SifrrLazyPicture, { extends: 'picture' });\n\nexport default SifrrLazyPicture;\n"],"names":["moveAttr","el","attr","dataset","setAttribute","removeAttribute","loadPicture","pic","tagName","querySelectorAll","forEach","s","querySelector","Error","onVisible","entries","entry","isIntersecting","target","_loaded","beforeLoad","unobserve","afterLoad","LazyLoader","window","IntersectionObserver","constructor","rootMargin","prototype","_observe","observe","SifrrLazyPicture","SifrrDom","Element","extends","HTMLPictureElement","observer","_observer","onConnect","reload","onDisconnect","register"],"mappings":";;;;;;;;;EAAA,SAASA,QAAT,CAAkBC,EAAlB,EAAsBC,IAAtB,EAA4B;EAC1B,MAAI,CAACD,EAAE,CAACE,OAAH,CAAWD,IAAX,CAAL,EAAuB;EACvBD,EAAAA,EAAE,CAACG,YAAH,CAAgBF,IAAhB,EAAsBD,EAAE,CAACE,OAAH,CAAWD,IAAX,CAAtB;EACAD,EAAAA,EAAE,CAACI,eAAH,gBAA2BH,IAA3B;EACD;EAED,SAASI,WAAT,CAAqBC,GAArB,EAA0B;EACxB,MAAIA,GAAG,CAACC,OAAJ,KAAgB,SAApB,EAA+B;EAC7BD,IAAAA,GAAG,CAACE,gBAAJ,CAAqB,QAArB,EAA+BC,OAA/B,CAAwCC,CAAD,IAAO;EAC5CX,MAAAA,QAAQ,CAACW,CAAD,EAAI,KAAJ,CAAR;EACAX,MAAAA,QAAQ,CAACW,CAAD,EAAI,QAAJ,CAAR;EACD,KAHD;EAIAJ,IAAAA,GAAG,GAAGA,GAAG,CAACK,aAAJ,CAAkB,KAAlB,CAAN;EACD,GAND,MAMO,IAAIL,GAAG,CAACC,OAAJ,KAAgB,KAApB,EAA2B;EAChC,UAAMK,KAAK,CAAC,8DAAD,EAAiEN,GAAjE,CAAX;EACD;EACDP,EAAAA,QAAQ,CAACO,GAAD,EAAM,KAAN,CAAR;EACAP,EAAAA,QAAQ,CAACO,GAAD,EAAM,QAAN,CAAR;EACA,SAAO,IAAP;EACD;EAED,SAASO,SAAT,CAAmBC,OAAnB,EAA4B;EAC1BA,EAAAA,OAAO,CAACL,OAAR,CAAgBM,KAAK,IAAI;EACvB,QAAIA,KAAK,CAACC,cAAN,IAAwB,CAACD,KAAK,CAACE,MAAN,CAAaC,OAA1C,EAAmD;EACjDH,MAAAA,KAAK,CAACE,MAAN,CAAaC,OAAb,GAAuB,IAAvB;EACA,UAAIH,KAAK,CAACE,MAAN,CAAaE,UAAjB,EAA6BJ,KAAK,CAACE,MAAN,CAAaE,UAAb;EAC7Bd,MAAAA,WAAW,CAACU,KAAK,CAACE,MAAP,CAAX;EACA,WAAKG,SAAL,CAAeL,KAAK,CAACE,MAArB;EACA,UAAIF,KAAK,CAACE,MAAN,CAAaI,SAAjB,EAA4BN,KAAK,CAACE,MAAN,CAAaI,SAAb;EAC7B;EACF,GARD;EASD;EAED,MAAMC,UAAN,SAAyBC,MAAM,CAACC,oBAAhC,CAAqD;EACnDC,EAAAA,WAAW,CAACC,UAAU,GAAG,iBAAd,EAAiC;EAC1C,UAAMb,SAAN,EAAiB;EAAEa,MAAAA;EAAF,KAAjB;EACD;EAHkD;EAMrDJ,UAAU,CAACK,SAAX,CAAqBC,QAArB,GAAgCN,UAAU,CAACK,SAAX,CAAqBE,OAArD;EACAP,UAAU,CAACK,SAAX,CAAqBE,OAArB,GAA+B,UAAS7B,EAAT,EAAa;EAC1CA,EAAAA,EAAE,CAACkB,OAAH,GAAa,KAAb;EACA,OAAKU,QAAL,CAAc5B,EAAd;EACD,CAHD;;ECrCA,MAAM8B,gBAAN,SAA+BC,QAAQ,CAACC,OAAT,CAAiBC,OAAjB,CAAyBC,kBAAzB,CAA/B,CAA4E;EAC1E,aAAWC,QAAX,GAAsB;EACpB,SAAKC,SAAL,GAAiB,KAAKA,SAAL,IAAkB,IAAId,UAAJ,CAAe,KAAKI,UAApB,CAAnC;EACA,WAAO,KAAKU,SAAZ;EACD;EAEDC,EAAAA,SAAS,GAAG;EACV,SAAKC,MAAL;EACD;EAEDA,EAAAA,MAAM,GAAG;EACP,SAAKb,WAAL,CAAiBU,QAAjB,CAA0BN,OAA1B,CAAkC,IAAlC;EACD;EAEDU,EAAAA,YAAY,GAAG;EACb,SAAKd,WAAL,CAAiBU,QAAjB,CAA0Bf,SAA1B,CAAoC,IAApC;EACD;EAhByE;EAmB5EU,gBAAgB,CAACJ,UAAjB,GAA8B,kBAA9B;EAEAK,QAAQ,CAACS,QAAT,CAAkBV,gBAAlB,EAAoC;EAAEG,EAAAA,OAAO,EAAE;EAAX,CAApC;;;;;;;;;;;"}