{"version":3,"file":"sifrrlazyimg.js","sources":["../../../helpers/lazyloader.js","../src/sifrrlazyimg.js"],"sourcesContent":["function moveAttr(el, attr) {\n  if (!el.dataset[attr]) return;\n  el.setAttribute(attr, el.dataset[attr]);\n  el.removeAttribute(`data-${attr}`);\n}\n\nfunction loadPicture(pic) {\n  if (pic.tagName === 'PICTURE') {\n    pic.querySelectorAll('source').forEach((s) => {\n      moveAttr(s, 'src');\n      moveAttr(s, 'srcset');\n    });\n    pic = pic.querySelector('img');\n  } else if (pic.tagName !== 'IMG') {\n    throw Error('LazyLoader only supports `picture` or `img` element. Given: ', pic);\n  }\n  moveAttr(pic, 'src');\n  moveAttr(pic, 'srcset');\n  return true;\n}\n\nfunction onVisible(entries) {\n  entries.forEach(entry => {\n    if (entry.isIntersecting && !entry.target._loaded) {\n      entry.target._loaded = true;\n      if (entry.target.beforeLoad) entry.target.beforeLoad();\n      loadPicture(entry.target);\n      this.unobserve(entry.target);\n      if (entry.target.afterLoad) entry.target.afterLoad();\n    }\n  });\n}\n\nclass LazyLoader extends window.IntersectionObserver {\n  constructor(rootMargin = '0px 0px 0px 0px') {\n    super(onVisible, { rootMargin });\n  }\n}\n\nmodule.exports = LazyLoader;\n","import SifrrDom from '@sifrr/dom';\nimport LazyLoader from '../../../helpers/lazyloader';\n\nclass SifrrLazyImg extends SifrrDom.Element.extends(HTMLImageElement) {\n  static get observer() {\n    this._observer = this._observer || new LazyLoader(this.rootMargin);\n    return this._observer;\n  }\n\n  onConnect() {\n    this.reload();\n  }\n\n  reload() {\n    this._loaded = false;\n    this.constructor.observer.observe(this);\n  }\n\n  onDisconnect() {\n    this.constructor.observer.unobserve(this);\n  }\n}\n\nSifrrLazyImg.rootMargin = '0px 0px 50px 0px';\n\nSifrrDom.register(SifrrLazyImg, { extends: 'img' });\n\nexport default SifrrLazyImg;\n"],"names":["moveAttr","el","attr","dataset","setAttribute","removeAttribute","loadPicture","pic","tagName","querySelectorAll","forEach","s","querySelector","Error","onVisible","entries","entry","isIntersecting","target","_loaded","beforeLoad","unobserve","afterLoad","LazyLoader","window","IntersectionObserver","constructor","rootMargin","SifrrLazyImg","SifrrDom","Element","extends","HTMLImageElement","observer","_observer","onConnect","reload","observe","onDisconnect","register"],"mappings":";;;;;;;;;EAAA,SAASA,QAAT,CAAkBC,EAAlB,EAAsBC,IAAtB,EAA4B;EAC1B,MAAI,CAACD,EAAE,CAACE,OAAH,CAAWD,IAAX,CAAL,EAAuB;EACvBD,EAAAA,EAAE,CAACG,YAAH,CAAgBF,IAAhB,EAAsBD,EAAE,CAACE,OAAH,CAAWD,IAAX,CAAtB;EACAD,EAAAA,EAAE,CAACI,eAAH,gBAA2BH,IAA3B;EACD;EAED,SAASI,WAAT,CAAqBC,GAArB,EAA0B;EACxB,MAAIA,GAAG,CAACC,OAAJ,KAAgB,SAApB,EAA+B;EAC7BD,IAAAA,GAAG,CAACE,gBAAJ,CAAqB,QAArB,EAA+BC,OAA/B,CAAwCC,CAAD,IAAO;EAC5CX,MAAAA,QAAQ,CAACW,CAAD,EAAI,KAAJ,CAAR;EACAX,MAAAA,QAAQ,CAACW,CAAD,EAAI,QAAJ,CAAR;EACD,KAHD;EAIAJ,IAAAA,GAAG,GAAGA,GAAG,CAACK,aAAJ,CAAkB,KAAlB,CAAN;EACD,GAND,MAMO,IAAIL,GAAG,CAACC,OAAJ,KAAgB,KAApB,EAA2B;EAChC,UAAMK,KAAK,CAAC,8DAAD,EAAiEN,GAAjE,CAAX;EACD;EACDP,EAAAA,QAAQ,CAACO,GAAD,EAAM,KAAN,CAAR;EACAP,EAAAA,QAAQ,CAACO,GAAD,EAAM,QAAN,CAAR;EACA,SAAO,IAAP;EACD;EAED,SAASO,SAAT,CAAmBC,OAAnB,EAA4B;EAC1BA,EAAAA,OAAO,CAACL,OAAR,CAAgBM,KAAK,IAAI;EACvB,QAAIA,KAAK,CAACC,cAAN,IAAwB,CAACD,KAAK,CAACE,MAAN,CAAaC,OAA1C,EAAmD;EACjDH,MAAAA,KAAK,CAACE,MAAN,CAAaC,OAAb,GAAuB,IAAvB;EACA,UAAIH,KAAK,CAACE,MAAN,CAAaE,UAAjB,EAA6BJ,KAAK,CAACE,MAAN,CAAaE,UAAb;EAC7Bd,MAAAA,WAAW,CAACU,KAAK,CAACE,MAAP,CAAX;EACA,WAAKG,SAAL,CAAeL,KAAK,CAACE,MAArB;EACA,UAAIF,KAAK,CAACE,MAAN,CAAaI,SAAjB,EAA4BN,KAAK,CAACE,MAAN,CAAaI,SAAb;EAC7B;EACF,GARD;EASD;EAED,MAAMC,UAAN,SAAyBC,MAAM,CAACC,oBAAhC,CAAqD;EACnDC,EAAAA,WAAW,CAACC,UAAU,GAAG,iBAAd,EAAiC;EAC1C,UAAMb,SAAN,EAAiB;EAAEa,MAAAA;EAAF,KAAjB;EACD;EAHkD;EAMrD,cAAc,GAAGJ,UAAjB;;ECpCA,MAAMK,YAAN,SAA2BC,QAAQ,CAACC,OAAT,CAAiBC,OAAjB,CAAyBC,gBAAzB,CAA3B,CAAsE;EACpE,aAAWC,QAAX,GAAsB;EACpB,SAAKC,SAAL,GAAiB,KAAKA,SAAL,IAAkB,IAAIX,UAAJ,CAAe,KAAKI,UAApB,CAAnC;EACA,WAAO,KAAKO,SAAZ;EACD;EAEDC,EAAAA,SAAS,GAAG;EACV,SAAKC,MAAL;EACD;EAEDA,EAAAA,MAAM,GAAG;EACP,SAAKjB,OAAL,GAAe,KAAf;EACA,SAAKO,WAAL,CAAiBO,QAAjB,CAA0BI,OAA1B,CAAkC,IAAlC;EACD;EAEDC,EAAAA,YAAY,GAAG;EACb,SAAKZ,WAAL,CAAiBO,QAAjB,CAA0BZ,SAA1B,CAAoC,IAApC;EACD;EAjBmE;EAoBtEO,YAAY,CAACD,UAAb,GAA0B,kBAA1B;EAEAE,QAAQ,CAACU,QAAT,CAAkBX,YAAlB,EAAgC;EAAEG,EAAAA,OAAO,EAAE;EAAX,CAAhC;;;;;;;;;;;"}